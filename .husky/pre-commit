#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Prisma schema ë³€ê²½ ê°ì§€
if git diff --cached --name-only | grep -q "prisma/schema.prisma"; then
  echo "ğŸ” Detected changes in prisma/schema.prisma"

  # ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ë„ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
  if git diff --cached --name-only | grep -q "prisma/migrations/"; then
    echo "âœ… Migration files also changed - OK"
  else
    echo ""
    echo "âŒ ERROR: schema.prisma changed but no migration files were staged!"
    echo ""
    echo "Please run:"
    echo "  npx prisma migrate dev --name describe_your_change"
    echo ""
    echo "Then stage the new migration files and commit again."
    echo ""
    exit 1
  fi
fi

# Prisma schema ìœ íš¨ì„± ê²€ì‚¬
if git diff --cached --name-only | grep -q "prisma/"; then
  echo "ğŸ” Validating Prisma schema..."
  npx prisma validate || {
    echo ""
    echo "âŒ ERROR: Prisma schema validation failed!"
    echo ""
    exit 1
  }
  echo "âœ… Prisma schema is valid"
fi
